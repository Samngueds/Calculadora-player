# .github/workflows/release.yml
name: Build Calculadora by samns

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 8.0.x
    
    - name: Build
      run: |
        dotnet publish -c Release -r win-x86 --self-contained true /p:PublishSingleFile=true
        dotnet publish -c Release -r win-x64 --self-contained true /p:PublishSingleFile=true
    
    - name: Prepare Release
      run: |
        mkdir release
        copy "bin\Release\net8.0\win-x86\publish\*.exe" "release\Calculadora-by-samns-x86.exe"
        copy "bin\Release\net8.0\win-x64\publish\*.exe" "release\Calculadora-by-samns-x64.exe"
        
        echo @echo off > release\Iniciar-Calculadora.bat
        echo if "%%PROCESSOR_ARCHITECTURE%%"=="AMD64" ( >> release\Iniciar-Calculadora.bat
        echo     start "" "Calculadora-by-samns-x64.exe" >> release\Iniciar-Calculadora.bat
        echo ) else ( >> release\Iniciar-Calculadora.bat
        echo     start "" "Calculadora-by-samns-x86.exe" >> release\Iniciar-Calculadora.bat
        echo ) >> release\Iniciar-Calculadora.bat
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v${{ github.run_number }}
        name: Calculadora by samns v${{ github.run_number }}
        body: |
          Calculadora by samns
          - Versão para Windows 32-bit e 64-bit
          - Execute o arquivo "Iniciar-Calculadora.bat" para iniciar automaticamente a versão correta
        files: release/*
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
