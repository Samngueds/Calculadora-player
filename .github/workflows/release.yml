name: Build Calculadora Plus by samns

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest

    steps:
    # 1. Checkout do c√≥digo
    - name: Checkout Code
      uses: actions/checkout@v2

    # 2. Configura√ß√£o do .NET
    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 8.0.x

    # 3. Build do projeto
    - name: Build Project
      run: |
        # Publica a vers√£o x86 e salva em um diret√≥rio espec√≠fico
        dotnet publish -c Release -r win-x86 --self-contained true /p:PublishSingleFile=true /p:PublishDir=output/win-x86/
        # Publica a vers√£o x64 e salva em um diret√≥rio espec√≠fico
        dotnet publish -c Release -r win-x64 --self-contained true /p:PublishSingleFile=true /p:PublishDir=output/win-x64/

    # 4. Depura√ß√£o e verifica√ß√£o de sa√≠da
    - name: Debug Output
      shell: pwsh
      run: |
        Write-Host "Verificando conte√∫do da pasta 'output':"
        Get-ChildItem -Recurse output

    # 5. Prepara√ß√£o dos arquivos para o release
    - name: Prepare Release
      shell: pwsh
      run: |
        # Cria a pasta release, se n√£o existir
        if (-not (Test-Path "release")) {
            New-Item -ItemType Directory -Path "release"
        }

        # Cria a pasta Music dentro de release
        if (-not (Test-Path "release\Music")) {
            New-Item -ItemType Directory -Path "release\Music"
        }

        # Copia execut√°veis para a pasta release
        if (Test-Path "output/win-x86") {
            Copy-Item -Path "output/win-x86/*.exe" -Destination "release/Calculadora-Plus-samns-x86.exe"
        } else {
            Write-Error "Caminho output/win-x86 n√£o encontrado."
        }

        if (Test-Path "output/win-x64") {
            Copy-Item -Path "output/win-x64/*.exe" -Destination "release/Calculadora-Plus-samns-x64.exe"
        } else {
            Write-Error "Caminho output/win-x64 n√£o encontrado."
        }

        # Adiciona a pasta Music
        Copy-Item -Path "Music/*" -Destination "release/Music" -Recurse -ErrorAction SilentlyContinue

        # Cria o script de inicializa√ß√£o .bat
        $batContent = @"
@echo off
if "%PROCESSOR_ARCHITECTURE%"=="AMD64" (
    start "" "Calculadora-Plus-samns-x64.exe"
) else (
    start "" "Calculadora-Plus-samns-x86.exe"
)
"@
        Set-Content -Path "release\Iniciar-Calculadora-Plus.bat" -Value $batContent

    # 6. Cria√ß√£o do release no GitHub
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v${{ github.run_number }}
        name: üéµ Calculadora Plus by samns v${{ github.run_number }}
        body: |
          # üéÆ Calculadora Plus by samns
          Uma calculadora moderna com interface colorida e player de m√∫sica integrado!
          
          ## ‚ú® Funcionalidades
          ### üßÆ Calculadora
          - ‚ûï Adi√ß√£o
          - ‚ûñ Subtra√ß√£o
          - ‚úñÔ∏è Multiplica√ß√£o
          - ‚ûó Divis√£o
          - üé® Interface colorida com ASCII art
          - ‚ö° Valida√ß√£o avan√ßada de entrada
          
          ### üéµ Player de M√∫sica
          - üéº Reprodu√ß√£o de arquivos MP3
          - üìÅ Gerenciamento autom√°tico da pasta Music
          - ‚èØÔ∏è Controles de reprodu√ß√£o
          - üìù Lista de m√∫sicas din√¢mica
          
          ## üíª Requisitos
          - Windows 32-bit (x86) ou 64-bit (x64)
          - Arquivos MP3 para o player de m√∫sica
          
          ## üì• Instala√ß√£o
          1. Baixe o arquivo "Iniciar-Calculadora-Plus.bat"
          2. Execute o arquivo baixado
          3. Para usar o player de m√∫sica:
             - Adicione seus arquivos MP3 na pasta "Music"
             - Selecione a op√ß√£o 6 no menu principal
          
          ## üì¶ Arquivos Inclu√≠dos
          - `Calculadora-Plus-samns-x64.exe` - Vers√£o 64-bit
          - `Calculadora-Plus-samns-x86.exe` - Vers√£o 32-bit
          - `Iniciar-Calculadora-Plus.bat` - Inicializador autom√°tico
          - `Music/` - Pasta para seus arquivos MP3
          
          ## üîç Caracter√≠sticas T√©cnicas
          - Interface colorida usando Colorful.Console
          - Player de m√∫sica usando NAudio
          - Menu interativo com ASCII art
          - Tratamento avan√ßado de erros
          - Estrutura de c√≥digo organizada
          
          ## üÜï O que h√° de novo
          - Interface totalmente colorida
          - Player de m√∫sica integrado
          - Melhor tratamento de erros
          - Suporte a n√∫meros decimais
          - ASCII art personalizado
          
          ## üë®‚Äçüíª Desenvolvido por
          samns
          
          ## üéØ Pr√≥ximas Atualiza√ß√µes
          - [ ] Equaliza√ß√£o de √°udio
          - [ ] Mais opera√ß√µes matem√°ticas
          - [ ] Hist√≥rico de c√°lculos
          - [ ] Playlist de m√∫sicas
          
          ## üì¢ Feedback
          Encontrou algum problema ou tem sugest√µes?
          Abra uma issue no GitHub!
          
          ---
          *Vers√£o gerada automaticamente pelo GitHub Actions em ${{ github.event.head_commit.timestamp }}*
        files: release/*
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
